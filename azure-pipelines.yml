# Starter pipeline

variables:
  server: 'localhost'
  jobId: $(System.JobId)
  jobName: $(System.JobName)
  job: $(jobId)"_"$(jobName)
  jobDisplayName: $(System.JobDisplayName)
  jobAttempt: $(System.JobAttempt)
  defId: $(System.DefinitionId)
  buildNumber: $(Build.BuildNumber)
  buildDef: $(Build.DefinitionName)
  
parameters:
- name: targetEnvironment
  displayName: Target Environment
  type: string
  default: stage
  values:
  - stage  
  - sit
  - uat
  - prod

trigger:
- master

pool:
  name: lxn-agent-pool

stages:
- stage: Build
  jobs:
  - job: ABE_Job
    steps:
    - bash: |
       echo $(buildNumber)
       echo $(buildDef)
       echo $(defId)
       echo $(job)
       echo $(jobId)
       echo $(jobName)
       echo $(jobDisplayName)
       echo $(jobAttempt)       
       echo $(Agent.BuildDirectory)
       echo $(sagHome)
       echo ${{parameters.targetEnvironment}}
       BuildDir=$(Agent.BuildDirectory)
       echo $BuildDir
       cd $(sagHome)/common/AssetBuildEnvironment/bin/
       ./build.sh \
        -Dsag.install.dir=$(sagHome) \
        -Dbuild.source.dir=$BuildDir/s/source/IS/ \
        -Dbuild.output.dir=$BuildDir/build/ \
        -Denable.build.IS=true \
        -Dbuild.version=1.0      
       
       cd $BuildDir/build/
       ls -ltr
    displayName: 'Create ABE Build'

- stage: Stage
  jobs:
  - job: Stage_Deploy_Job
    steps:
      - script: echo Hello, DevJob1! $(System.JobId) $(name)
    displayName: 'Deploy_Stage_Env'

- stage: CleanUp
  jobs:
  - job: Cleanup_Job
    steps:
    - bash: |
       echo $(System.JobId) $(name)
       cd $(Agent.BuildDirectory)
       ls -ltr
       rm -rf *
       echo "Deleted the files"
       ls -ltr
         